{% extends 'app/base.html' %}

{% block content %}
  <h1>Menu Generator</h1>
  <form id="menuForm">
    <label for="ingredients">Ingredients:</label>
    <textarea id="ingredients" name="ingredients" rows="4" cols="50"></textarea><br><br>
    <label for="month">Month:</label>
    <select id="month" name="month">
      <option value="1">January</option>
      <option value="2">February</option>
      <!-- Add other months -->
    </select><br><br>
    <button type="submit">Generate Menu</button>
  </form>

  <div id="menuOutput"></div>
  <div id="downloadLink"></div>

  <script>
    document.getElementById("menuForm").addEventListener("submit", function(event){
      event.preventDefault();

      // Get form data
      const ingredients = document.getElementById("ingredients").value.split('\n');
      const month = document.getElementById("month").value;

      // Send data to the backend
      fetch('/app/generate_menu/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ingredients: ingredients, month: month})
      })
      .then(response => response.json())
      .then(data => {
        // Display menu and download link
        document.getElementById("menuOutput").innerHTML = data.menu;
        document.getElementById("downloadLink").innerHTML = `<a href="/app/download_menu/${data.filename}/">Download Excel</a>`;
      });
    });
  </script>
{% endblock %}
